Here is the recipe I followed:

-Melt the butter in a sauté pan over medium heat. Add the mushrooms and garlic, cooking until the mushrooms lose their moisture and become soft, about 5 minutes.

-Bring a large pot of water to a boil, then add the salt and spaghetti. Cook the pasta according to the instructions on the package, until the spaghetti is al dente. When finished, save 1 cup of water that you cooked the pasta in, and strain out the rest.

-Heat the olive oil in a large pan over medium-high heat. When hot add the onions and garlic and sauté until the onion turns translucent and begins to brown, about 5 minutes. Sprinkle over the flour and stir to coat the onions, let cook for about 60 seconds.

-Whisk in all of the remaining ingredients. Cook the sauce for about 5 minutes until thickened, whisking as needed.

-Add the cooked pasta to the sauce and toss well to combine. Serve hot. Garnish with parsley and parmegan if desired.